# Code for airtable

```jsx
// Get list of tenants, removing house men:
let tenant_table = base.getTable("Tenants");
let tenant_query = await tenant_table.selectRecordsAsync();
let active_tenants = tenant_query.records.filter(
    record => record.getCellValueAsString('Affiliation') !== 'House');
//Get Chore types
let chores_table = base.getTable("Chore Type")
let chores_query = await chores_table.selectRecordsAsync();
let chore_types = chores_query.records.map(choreRecord => choreRecord.getCellValueAsString('ID'));
//Get chore history & chores that need to be assigned 
let past_chores_table = base.getTable("Chores")
let past_chores_query = await past_chores_table.selectRecordsAsync();
let blank_chores = past_chores_query.records.filter(
    record => record.getCellValueAsString('Tenant') !== "");

// Create a matrix to store chore assignments
let chore_matrix = {};

// Initialize columns based on chore types
chore_types.forEach(chore_name => {
    chore_matrix[chore_name] = {}; // Initialize column for chore type
});

// Populate rows for each tenant
active_tenants.forEach(tenantRecord => {
    let tenant_name = tenantRecord.getCellValueAsString('First Name');
    chore_types.forEach(chore_name => {
        let current_chore = chore_name.toString()
        //console.log(current_chore)
        let count = chore_count(tenantRecord, current_chore)
        chore_matrix[chore_name][tenant_name] = count; // Initialize cell with empty string
    });
});

console.log(chore_matrix)

// Get a count of how many times this tenant has done this chore
function chore_count(tenant, chore) {
    let linkedRecords = tenant.getCellValue("Chores");
    let count = 0;
    linkedRecords.forEach( linked_chore => {
        let linked_ID = linked_chore.id
        let loaded_linked_chore =  past_chores_query.getRecord(linked_ID)
        let linked_type = loaded_linked_chore.getCellValueAsString("Type");
        if (linked_type == chore) {count++}
    })
    return count
}
```

### Old Code & references:

```jsx
// Get list of chores
let chores_table = base.getTable("Chores")
let chores_query = await chores_table.selectRecordsAsync();

//Selecting past chores that have people assigned, and blank chores with no one assigned
let past_chores = chores_query.records.filter(
    record => record.getCellValueAsString('Tenant') !== "");
let blank_chores = chores_query.records.filter(
    record => record.getCellValueAsString('Tenant') == "");
```

```jsx
let mainTable = base.getTable("Main Table");
let query = await mainTable.selectRecordsAsync();

query.records.forEach(async record => {
    // Get the linked records from the linked record field named "Linked Records"
    let linkedRecords = record.getCellValue("Linked Records");

    // Access details of each linked record
    linkedRecords.forEach(async linkedRecord => {
        let linkedRecordTable = linkedRecord._table; // Get the table of the linked record
        let linkedRecordId = linkedRecord.id; // Get the ID of the linked record

        // Load the linked record asynchronously to access its fields
        let loadedLinkedRecord = await linkedRecordTable.loadRecordAsync(linkedRecordId);

        // Access fields of the linked record
        let linkedRecordName = loadedLinkedRecord.getCellValue("Name");
        let linkedRecordDescription = loadedLinkedRecord.getCellValue("Description");

        console.log("Linked Record Name:", linkedRecordName);
        console.log("Linked Record Description:", linkedRecordDescription);
    });
});
```

```jsx
// Fetch records from the "Parent Table" and "Child Table"
let parentTable = base.getTable("Parent Table");
let childTable = base.getTable("Child Table");

let parentQuery = await parentTable.selectRecordsAsync();
let childQuery = await childTable.selectRecordsAsync();

let parentRecords = parentQuery.records;
let childRecords = childQuery.records;

// Define a function to find the parent record by name
function findParentRecordByName(records, name) {
    return records.find(record => record.getCellValue("Name") === name);
}

// Iterate over each child record
for (let childRecord of childRecords) {
    let childName = childRecord.getCellValue("Name");
    
    // Find the corresponding parent record by name
    let parentRecord = findParentRecordByName(parentRecords, childName);
    
    // If a matching parent record is found
    if (parentRecord) {
        // Get the current linked records of the parent
        let linkedRecords = parentRecord.getCellValue("Linked Field");
        
        // Add the ID of the new child record to the linked records array
        linkedRecords.push({ id: childRecord.id });
        
        // Update the parent record to include the new linked record
        await parentTable.updateRecordAsync(parentRecord, {
            "Linked Field": linkedRecords
        });
    } else {
        console.error(`No matching parent record found for child record with name ${childName}`);
    }
}

```